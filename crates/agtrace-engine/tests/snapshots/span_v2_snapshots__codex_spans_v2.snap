---
source: crates/agtrace-engine/tests/span_v2_snapshots.rs
expression: spans
---
[
  {
    "user": {
      "ts": "2025-12-09T19:55:16.336+00:00",
      "role": "user",
      "text": "<environment_context>\n  <cwd>/Users/zawakin/agent-sample</cwd>\n  <approval_policy>on-request</approval_policy>\n  <sandbox_mode>workspace-write</sandbox_mode>\n  <network_access>restricted</network_access>\n  <shell>zsh</shell>\n</environment_context>",
      "tokens": null
    },
    "assistant": [],
    "tools": [],
    "reasoning": [],
    "system": [],
    "stats": {
      "tool_calls": 0,
      "tool_failures": 0,
      "e2e_ms": null,
      "pre_tool_ms": null,
      "tool_ms": null,
      "post_tool_ms": null,
      "tokens_total": null
    }
  },
  {
    "user": {
      "ts": "2025-12-09T19:55:18.143+00:00",
      "role": "user",
      "text": "add myapp directory and create myapp/hoge.py which shows result of print(1+1).",
      "tokens": null
    },
    "assistant": [],
    "tools": [],
    "reasoning": [],
    "system": [],
    "stats": {
      "tool_calls": 0,
      "tool_failures": 0,
      "e2e_ms": null,
      "pre_tool_ms": null,
      "tool_ms": null,
      "post_tool_ms": null,
      "tokens_total": null
    }
  },
  {
    "user": {
      "ts": "2025-12-09T19:55:18.144+00:00",
      "role": "user",
      "text": "add myapp directory and create myapp/hoge.py which shows result of print(1+1).",
      "tokens": null
    },
    "assistant": [
      {
        "ts": "2025-12-09T19:55:37.423+00:00",
        "role": "assistant",
        "text": "Added simple script in `myapp/hoge.py` that prints the result of `1 + 1`.",
        "tokens": null
      },
      {
        "ts": "2025-12-09T19:55:37.424+00:00",
        "role": "assistant",
        "text": "Added simple script in `myapp/hoge.py` that prints the result of `1 + 1`.",
        "tokens": {
          "input": 3815,
          "output": 26,
          "total": 3841,
          "cached": 3584,
          "thinking": 0
        }
      }
    ],
    "tools": [
      {
        "call_id": "call_DyhFJrJJb2y0MiOOHVP7KaVG",
        "ts_call": "2025-12-09T19:55:30.116+00:00",
        "tool_name": "shell_command",
        "input_summary": "mkdir -p myapp",
        "ts_result": "2025-12-09T19:55:30.257+00:00",
        "status": "success",
        "exit_code": 0,
        "latency_ms": 141,
        "error_summary": null
      },
      {
        "call_id": "call_pBXH93fl6ZXH2svDOFIlr8GA",
        "ts_call": "2025-12-09T19:55:34.147+00:00",
        "tool_name": "apply_patch",
        "input_summary": "",
        "ts_result": "2025-12-09T19:55:35.204+00:00",
        "status": "success",
        "exit_code": null,
        "latency_ms": 1057,
        "error_summary": null
      }
    ],
    "reasoning": [
      "**Creating directory and file using shell and patch**",
      "**Creating directory and file using shell and patch**",
      "**Creating file with patch**\n\nI'm creating a new file containing `print(1+1)` using the apply_patch method ensuring ASCII encoding.",
      "**Creating file with patch**\n\nI'm creating a new file containing `print(1+1)` using the apply_patch method ensuring ASCII encoding."
    ],
    "system": [],
    "stats": {
      "tool_calls": 2,
      "tool_failures": 0,
      "e2e_ms": 19280,
      "pre_tool_ms": 11972,
      "tool_ms": 5088,
      "post_tool_ms": 2220,
      "tokens_total": 3841
    }
  },
  {
    "user": {
      "ts": "2025-12-09T19:55:45.472+00:00",
      "role": "user",
      "text": "cd to myapp and run python hoge.py",
      "tokens": null
    },
    "assistant": [],
    "tools": [],
    "reasoning": [],
    "system": [],
    "stats": {
      "tool_calls": 0,
      "tool_failures": 0,
      "e2e_ms": null,
      "pre_tool_ms": null,
      "tool_ms": null,
      "post_tool_ms": null,
      "tokens_total": null
    }
  },
  {
    "user": {
      "ts": "2025-12-09T19:55:45.472+00:00",
      "role": "user",
      "text": "cd to myapp and run python hoge.py",
      "tokens": null
    },
    "assistant": [
      {
        "ts": "2025-12-09T19:56:06.171+00:00",
        "role": "assistant",
        "text": "Ran the script with `python3` (since `python` shim isn’t available here). Output from `myapp/hoge.py`:\n- 2",
        "tokens": null
      },
      {
        "ts": "2025-12-09T19:56:06.171+00:00",
        "role": "assistant",
        "text": "Ran the script with `python3` (since `python` shim isn’t available here). Output from `myapp/hoge.py`:\n- 2",
        "tokens": {
          "input": 4139,
          "output": 38,
          "total": 4177,
          "cached": 3968,
          "thinking": 0
        }
      }
    ],
    "tools": [
      {
        "call_id": "call_5j2yJgrbOClvto1R8nvfSoJS",
        "ts_call": "2025-12-09T19:55:50.553+00:00",
        "tool_name": "shell_command",
        "input_summary": "python hoge.py",
        "ts_result": "2025-12-09T19:55:50.681+00:00",
        "status": "success",
        "exit_code": 1,
        "latency_ms": 128,
        "error_summary": "Exit code: 1\nWall time: 0.1 seconds\nOutput:\n/opt/homebrew/Library/Homebrew/cmd/shellenv.sh: line ..."
      },
      {
        "call_id": "call_hm1XO5EQnKjpErxjNjpINQ2x",
        "ts_call": "2025-12-09T19:55:55.447+00:00",
        "tool_name": "shell_command",
        "input_summary": "python hoge.py",
        "ts_result": "2025-12-09T19:55:59.497+00:00",
        "status": "success",
        "exit_code": 1,
        "latency_ms": 4050,
        "error_summary": "Exit code: 1\nWall time: 0.1 seconds\nOutput:\nerror: target shim binary not found\n"
      },
      {
        "call_id": "call_mI2n5JLETgVMNGApYPPAjEwD",
        "ts_call": "2025-12-09T19:56:02.618+00:00",
        "tool_name": "shell_command",
        "input_summary": "python3 hoge.py",
        "ts_result": "2025-12-09T19:56:02.744+00:00",
        "status": "success",
        "exit_code": 0,
        "latency_ms": 126,
        "error_summary": null
      }
    ],
    "reasoning": [
      "**Running Python script in workspace**",
      "**Running Python script in workspace**",
      "**Handling command failure with escalation**\n\nThe command failure might be due to environment issues like missing shim binaries or path problems related to nix or Homebrew; I'll implement a retry with escalated permissions that requires an approval request including a justification.",
      "**Handling command failure with escalation**\n\nThe command failure might be due to environment issues like missing shim binaries or path problems related to nix or Homebrew; I'll implement a retry with escalated permissions that requires an approval request including a justification.",
      "**Considering python3 usage**\n\nNoticing possible Python shim or missing installation issues, so trying `python3` command as an alternative.",
      "**Considering python3 usage**\n\nNoticing possible Python shim or missing installation issues, so trying `python3` command as an alternative.",
      "**Noting python3 usage due to missing shim**\n\nThe output shows success but includes a shell environment message; python3 is used explicitly since the python shim is missing.",
      "**Noting python3 usage due to missing shim**\n\nThe output shows success but includes a shell environment message; python3 is used explicitly since the python shim is missing."
    ],
    "system": [],
    "stats": {
      "tool_calls": 3,
      "tool_failures": 2,
      "e2e_ms": 20699,
      "pre_tool_ms": 5081,
      "tool_ms": 12191,
      "post_tool_ms": 3427,
      "tokens_total": 4177
    }
  }
]
